

## SAS macros for applying the cell-key method based random noise approach

We provide the following SAS macros:

- `%ckm_generate_record_key();`: The macro can be used to generate and attach a record key variable to given microdata. Users have to specify the following arguments:
    + `inputfile`: The input file (e.g. `inputfile=work.microdata`)
    + `outputfile`: The output file (e.g. `outputfile=work.microdatawithrecordkey`)
    + `rkey`: The label of the new rekord key variable (e.g. `rkey=myrkey`)
    + `seed`: An initial seed for the purpose of reproducibility (e.g. `seed=54123`)

- `%ckm_summary();`: The macro is a modified version of `proc summary`. The most important feature is the aggregation of the record keys. Users have to specify the following arguments:
    + `input`: The input file (e.g. `input=work.microdatawithrecordkey`)
    + `output`: The output file (e.g. `output=work.macrodatawithcellkey`)
    + `table_var`: The variables that define the table (e.g. `table_var=gender age geo`)
    + `rkey`: The label/name of the record key variable that is in the data (e.g. `rkey=myrkey`)
    + `ckey`: The label/name of the cell key variable that is generated (e.g. `ckey=myckey`)
    + `cfreq` (otional): The label/name of the original cell freuency count variable (e.g. `cfreq=count`)
    + `rfreq` (otional): The label/name of the a record freuency count variable if there are pre-counted/aggregated units in the microdata (e.g. `rfreq=precount`)
    + `weight` (otional): The label/name of the weighting variable (e.g. `weight=designweight`)

- `%ckm_import_ptable();`: The macro imports the perturbation table that was generated by the the function `pt_create_pTable(..., type="destatis")` and exported by the function `pt_export(..., tool="SAS")` within the R-package (ptable)[https://github.com/sdcTools/ptable]. Users have to specify the following arguments:
    + `csvfile`: The path of the perturbation file (e.g. `csvfile=C:/folder/ptable01.csv`)
    + `output`: The output file (e.g. `output=work.myptable`)
    
- `%ckm_perturbation()`: The macro applies the cell-key method based random noise approach. Users have to specify the following arguments:
    + `input`: The input table/hypercube with cell keys (e.g. `input=work.macrodatawithcellkey`)
    + `table_var`: The variables that define the table of the input file (e.g. `table_var=gender age geo`)
    + `cfreq`: The label/name of the original freuency count variable (e.g. `orig=count`)
    + `ckey`: The label/name of the cell key variable (e.g. `ckey=myckey`)
    + `weight` (otional): The label/name of the weighting variable (e.g. `weight=designweight`)
    + `ptable`: The input file of the perturbation table (e.g. `ptable=work.myptable`)
    + `ckmlabel`: The suffix of the output file and the variable name of the perturbed frequency data (e.g. `ckmlabel=perturbed`)


## Examples 

To run the examples we provide, you will need the follwoing files:

- `hc_9_2_synth_microdata.sas7bdat`: A synthetic microdata set without recordkeys to create the Hypercube 9.2



### Example 1: How to generate and attach a record key variable to microdata

An example is given in the SAS-program `example_generate_recordkeys.sas`.


### Example 2: How to generate and attach a record key variable to microdata, aggregate the data and peturb the frequency counts

An example is given in the SAS-program `example_hc_9_2.sas`. 

You will also need:

- `example_hc_9_2_multilabel`: The SAS program provides the formats that are necessary to generate the hypercube 9.2 with all hierarchies and subtotals. The formats are used by the macro `%ckm_summary` for the given synthetic microdata (you will have to write your own formats for the data you want to aggreagte).

- `ptable_d2_v108_js1.csv`: A perturbation file that was generated with the ptable-Package as follows: 
```
param <- pt_create_pParams(D=2, V=1.08, js=1)
result <- pt_create_pTable(params=params, type="destatis")
pt_export(result, file="C:/ptable_d2_v108_js1.csv", tool="SAS")
```
